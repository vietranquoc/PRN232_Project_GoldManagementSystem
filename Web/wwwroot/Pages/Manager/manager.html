<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Manager Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="../../css/manager.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <div class="d-flex">
    <!-- Sidebar -->
    <nav class="sidebar p-3 d-flex flex-column">
      <div class="mb-4 text-center">
        <span class="navbar-brand m-0 p-0">
            <i class="fas fa-gem me-2"></i>GoldTrack
        </span>
      </div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link active" id="sidebar-dashboard" href="#"><i class="fas fa-chart-line"></i>Bảng điều khiển</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="sidebar-account" href="#"><i class="fas fa-users"></i>Tài khoản</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="sidebar-category" href="#"><i class="fas fa-tags"></i>Danh mục</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="sidebar-product" href="#"><i class="fas fa-boxes"></i>Sản phẩm</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="sidebar-goldtype" href="#"><i class="fas fa-ring"></i>Loại vàng</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="sidebar-goldprice" href="#"><i class="fas fa-coins"></i>Giá vàng</a>
        </li>
      </ul>
    </nav>
    <!-- Main Content -->
    <div class="flex-grow-1">
      <!-- Top Navbar -->
      <nav class="navbar navbar-expand-lg navbar-light px-4 py-2">
        <a class="navbar-brand" href="#">
            <i class="fas fa-gem me-2"></i>GoldTrack
        </a>
        <div class="ms-auto d-flex align-items-center">
          <div class="dropdown">
            <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="avatar dropdown-toggle" data-bs-toggle="dropdown" alt="User"/>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#">Tài khoản của tôi</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" href="#" onclick="logout()">Đăng xuất</a></li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- Dashboard Section -->
      <div id="dashboard-section">
        <div class="container-fluid py-4">
          <div class="row g-4">
            <div class="col-md-6 col-lg-4">
              <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span class="card-title">Tổng quan doanh số</span>
                  <i class="fas fa-chart-bar text-primary"></i>
                </div>
                <div class="chart-placeholder">[Biểu đồ cột]</div>
              </div>
            </div>
            <div class="col-md-6 col-lg-4">
              <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span class="card-title">Phân tích theo năm</span>
                  <i class="fas fa-chart-pie text-success"></i>
                </div>
                <div class="chart-placeholder">[Biểu đồ tròn]</div>
              </div>
            </div>
            <div class="col-md-6 col-lg-4">
              <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span class="card-title">Thu nhập tháng</span>
                  <i class="fas fa-dollar-sign text-warning"></i>
                </div>
                <div class="fs-2 fw-bold text-success">$12,500</div>
                <div class="text-muted">+8% so với tháng trước</div>
              </div>
            </div>
          </div>
          <div class="row g-4 mt-1">
            <div class="col-lg-8">
              <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span class="card-title">Giao dịch gần đây</span>
                  <i class="fas fa-exchange-alt text-info"></i>
                </div>
                <div class="table-responsive">
                  <table class="table table-borderless align-middle mb-0">
                    <thead>
                      <tr>
                        <th>Ngày</th>
                        <th>Khách hàng</th>
                        <th>Sản phẩm</th>
                        <th>Số tiền</th>
                        <th>Trạng thái</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>2024-07-01</td>
                        <td>Nguyễn Văn A</td>
                        <td>Nhẫn vàng</td>
                        <td>1.200$</td>
                        <td><span class="badge bg-success">Hoàn thành</span></td>
                      </tr>
                      <tr>
                        <td>2024-07-01</td>
                        <td>Trần Thị B</td>
                        <td>Dây chuyền</td>
                        <td>2.500$</td>
                        <td><span class="badge bg-warning text-dark">Chờ xử lý</span></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span class="card-title">Nhân viên xuất sắc</span>
                  <i class="fas fa-trophy text-warning"></i>
                </div>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Nguyễn Văn C <span class="badge bg-primary rounded-pill">15 giao dịch</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Lê Thị D <span class="badge bg-primary rounded-pill">12 giao dịch</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Phạm Văn E <span class="badge bg-primary rounded-pill">10 giao dịch</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Account Section (ẩn mặc định) -->
      <div id="account-section" style="display:none">
        <div class="container-fluid py-4">
          <!-- Header -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">Quản lý tài khoản</h2>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createAccountModal">
              <i class="fas fa-plus me-2"></i>Thêm nhân viên
            </button>
          </div>

          <!-- Filter Section -->
          <div class="dashboard-card mb-4">
            <div class="row g-3">
              <div class="col-md-4">
                <label for="roleFilter" class="form-label">Lọc theo vai trò</label>
                <select class="form-select" id="roleFilter">
                  <option value="">Tất cả vai trò</option>
                  <option value="Manager">Quản lý</option>
                  <option value="Employee">Nhân viên</option>
                  <option value="Customer">Khách hàng</option>
                </select>
              </div>
              <div class="col-md-4">
                <label for="statusFilter" class="form-label">Lọc theo trạng thái</label>
                <select class="form-select" id="statusFilter">
                  <option value="">Tất cả trạng thái</option>
                  <option value="Active">Đang hoạt động</option>
                  <option value="Inactive">Ngừng hoạt động</option>
                </select>
              </div>
              <div class="col-md-4">
                <label for="searchAccount" class="form-label">Tìm kiếm</label>
                <input type="text" class="form-control" id="searchAccount" placeholder="Tìm theo tên hoặc email...">
              </div>
            </div>
          </div>

          <!-- Accounts Table -->
          <div class="dashboard-card">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Mã</th>
                    <th>Tên đăng nhập</th>
                    <th>Email</th>
                    <th>Họ và tên</th>
                    <th>Vai trò</th>
                    <th>Trạng thái</th>
                    <th>Ngày tạo</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="accountsTableBody">
                </tbody>
              </table>
            </div>
            <div id="accountPagination"></div>
          </div>
        </div>

        <!-- Create Account Modal -->
        <div class="modal fade" id="createAccountModal" tabindex="-1">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Tạo tài khoản nhân viên mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <form id="createAccountForm" autocomplete="off">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="username" class="form-label">Tên đăng nhập *</label>
                      <input type="text" class="form-control" id="username" required autocomplete="off" placeholder="Nhập tên đăng nhập">
                    </div>
                    <div class="col-md-6">
                      <label for="email" class="form-label">Email *</label>
                      <input type="email" class="form-control" id="email" required autocomplete="off" placeholder="Nhập email">
                    </div>
                    <div class="col-md-6">
                      <label for="password" class="form-label">Mật khẩu *</label>
                      <input type="password" class="form-control" id="password" required minlength="6" autocomplete="new-password" placeholder="Nhập mật khẩu">
                    </div>
                    <div class="col-md-6">
                      <label for="confirmPassword" class="form-label">Xác nhận mật khẩu *</label>
                      <input type="password" class="form-control" id="confirmPassword" required minlength="6" autocomplete="new-password" placeholder="Nhập lại mật khẩu">
                    </div>
                    <div class="col-md-6">
                      <label for="fullName" class="form-label">Họ và tên *</label>
                      <input type="text" class="form-control" id="fullName" required placeholder="Nhập họ và tên">
                    </div>
                    <div class="col-md-6">
                      <label for="phone" class="form-label">Số điện thoại</label>
                      <input type="tel" class="form-control" id="phone" placeholder="Nhập số điện thoại">
                    </div>
                    <div class="col-md-6">
                      <label for="role" class="form-label">Vai trò</label>
                      <input type="text" class="form-control" id="role" value="Nhân viên" disabled>
                    </div>
                    <div class="col-12">
                      <label for="address" class="form-label">Địa chỉ</label>
                      <textarea class="form-control" id="address" rows="3" placeholder="Nhập địa chỉ"></textarea>
                    </div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="createAccount()">Tạo tài khoản</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Edit Account Modal -->
        <div class="modal fade" id="editAccountModal" tabindex="-1">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Edit Account</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <form id="editAccountForm">
                  <input type="hidden" id="editAccountId">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="editUsername" class="form-label">Username *</label>
                      <input type="text" class="form-control" id="editUsername" required>
                    </div>
                    <div class="col-md-6">
                      <label for="editEmail" class="form-label">Email *</label>
                      <input type="email" class="form-control" id="editEmail" required>
                    </div>
                    <div class="col-md-6">
                      <label for="editPassword" class="form-label">New Password</label>
                      <input type="password" class="form-control" id="editPassword" placeholder="Leave blank to keep current password">
                    </div>
                    <div class="col-md-6">
                      <label for="editConfirmPassword" class="form-label">Confirm New Password</label>
                      <input type="password" class="form-control" id="editConfirmPassword">
                    </div>
                    <div class="col-md-6">
                      <label for="editFullName" class="form-label">Full Name *</label>
                      <input type="text" class="form-control" id="editFullName" required>
                    </div>
                    <div class="col-md-6">
                      <label for="editPhone" class="form-label">Phone</label>
                      <input type="tel" class="form-control" id="editPhone">
                    </div>
                    <div class="col-md-6">
                      <label for="editRole" class="form-label">Role *</label>
                      <select class="form-select" id="editRole" required>
                        <option value="">Select Role</option>
                        <option value="Manager">Manager</option>
                        <option value="Employee">Employee</option>
                        <option value="Customer">Customer</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="editStatus" class="form-label">Status</label>
                      <select class="form-select" id="editStatus">
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                      </select>
                    </div>
                    <div class="col-12">
                      <label for="editAddress" class="form-label">Address</label>
                      <textarea class="form-control" id="editAddress" rows="3"></textarea>
                    </div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="updateAccount()">Update Account</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Category Section (ẩn mặc định) -->
      <div id="category-section" style="display:none">
        <div class="container-fluid py-4">
          <!-- Header -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">Quản lý danh mục</h2>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createCategoryModal">
              <i class="fas fa-plus me-2"></i>Thêm danh mục
            </button>
          </div>

          <!-- Filter Section -->
          <div class="dashboard-card mb-4">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="searchCategory" class="form-label">Tìm kiếm</label>
                <input type="text" class="form-control" id="searchCategory" placeholder="Tìm theo tên danh mục...">
              </div>
              <div class="col-md-6">
                <label for="statusCategoryFilter" class="form-label">Lọc theo trạng thái</label>
                <select class="form-select" id="statusCategoryFilter">
                  <option value="">Tất cả trạng thái</option>
                  <option value="Active">Đang hoạt động</option>
                  <option value="Inactive">Ngừng hoạt động</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Categories Table -->
          <div class="dashboard-card">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Mã</th>
                    <th>Tên danh mục</th>
                    <th>Mô tả</th>
                    <th>Trạng thái</th>
                    <th>Ngày tạo</th>
                    <th>Thao tác</th>
                  </tr>
                </thead>
                <tbody id="categoriesTableBody">
                </tbody>
              </table>
            </div>
            <div id="categoryPagination"></div>
          </div>
        </div>

        <!-- Create Category Modal -->
        <div class="modal fade" id="createCategoryModal" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Thêm danh mục mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <form id="createCategoryForm">
                  <div class="mb-3">
                    <label for="categoryName" class="form-label">Tên danh mục *</label>
                    <input type="text" class="form-control" id="categoryName" required placeholder="Nhập tên danh mục">
                  </div>
                  <div class="mb-3">
                    <label for="categoryDescription" class="form-label">Mô tả</label>
                    <textarea class="form-control" id="categoryDescription" rows="3" placeholder="Nhập mô tả danh mục"></textarea>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="createCategory()">Thêm danh mục</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Edit Category Modal -->
        <div class="modal fade" id="editCategoryModal" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Chỉnh sửa danh mục</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <form id="editCategoryForm">
                  <input type="hidden" id="editCategoryId">
                  <div class="mb-3">
                    <label for="editCategoryName" class="form-label">Tên danh mục *</label>
                    <input type="text" class="form-control" id="editCategoryName" required placeholder="Nhập tên danh mục">
                  </div>
                  <div class="mb-3">
                    <label for="editCategoryDescription" class="form-label">Mô tả</label>
                    <textarea class="form-control" id="editCategoryDescription" rows="3" placeholder="Nhập mô tả danh mục"></textarea>
                  </div>
                  <div class="mb-3">
                    <label for="editCategoryStatus" class="form-label">Trạng thái</label>
                    <select class="form-select" id="editCategoryStatus">
                      <option value="Active">Đang hoạt động</option>
                      <option value="Inactive">Ngừng hoạt động</option>
                    </select>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="updateCategory()">Cập nhật</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Product Section (ẩn mặc định) -->
      <div id="product-section" style="display:none">
        <div class="container-fluid py-4">
          <!-- Header -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">Quản lý sản phẩm</h2>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createProductModal">
              <i class="fas fa-plus me-2"></i>Thêm sản phẩm
            </button>
          </div>

          <!-- Filter Section -->
          <div class="dashboard-card mb-4">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="searchProduct" class="form-label">Tìm kiếm</label>
                <input type="text" class="form-control" id="searchProduct" placeholder="Tìm theo tên sản phẩm...">
              </div>
              <div class="col-md-6">
                <label for="statusProductFilter" class="form-label">Lọc theo trạng thái</label>
                <select class="form-select" id="statusProductFilter">
                  <option value="">Tất cả trạng thái</option>
                  <option value="Active">Đang hoạt động</option>
                  <option value="Inactive">Ngừng hoạt động</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Products Table -->
          <div class="dashboard-card">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Mã</th>
                    <th>Tên sản phẩm</th>
                    <th>Danh mục</th>
                    <th>Mô tả</th>
                    <th>Trạng thái</th>
                    <th>Ngày tạo</th>
                    <th>Thao tác</th>
                  </tr>
                </thead>
                <tbody id="productsTableBody">
                </tbody>
              </table>
            </div>
            <div id="productPagination"></div>
          </div>
        </div>

        <!-- Create Product Modal -->
        <div class="modal fade" id="createProductModal" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Thêm sản phẩm mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <form id="createProductForm" autocomplete="off">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="productName" class="form-label">Tên sản phẩm *</label>
                      <input type="text" class="form-control" id="productName" required placeholder="Nhập tên sản phẩm">
                    </div>
                    <div class="col-md-6">
                      <label for="productCategory" class="form-label">Danh mục *</label>
                      <select class="form-select" id="productCategory" required></select>
                    </div>
                    <div class="col-md-6">
                      <label for="productGoldType" class="form-label">Loại vàng *</label>
                      <select class="form-select" id="productGoldType" required></select>
                    </div>
                    <div class="col-md-6">
                      <label for="productPrice" class="form-label">Giá *</label>
                      <input type="number" class="form-control" id="productPrice" required>
                    </div>
                    <div class="col-md-6">
                      <label for="productQuantity" class="form-label">Số lượng *</label>
                      <input type="number" class="form-control" id="productQuantity" required>
                    </div>
                    <div class="col-12">
                      <label for="productDescription" class="form-label">Mô tả</label>
                      <textarea class="form-control" id="productDescription" rows="3" placeholder="Nhập mô tả sản phẩm"></textarea>
                    </div>
                    <div class="col-12">
                      <label for="productImages" class="form-label">Ảnh sản phẩm</label>
                      <input type="file" class="form-control" id="productImages" multiple accept="image/*" onchange="previewImages(this)">
                      <div id="imagePreview" class="mt-2 d-flex flex-wrap gap-2"></div>
                    </div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="createProduct()">Tạo sản phẩm</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Edit Product Modal -->
        <div class="modal fade" id="editProductModal" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Chỉnh sửa sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <form id="editProductForm">
                  <input type="hidden" id="editProductId">
                  <div class="mb-3">
                    <label for="editProductName" class="form-label">Tên sản phẩm *</label>
                    <input type="text" class="form-control" id="editProductName" required placeholder="Nhập tên sản phẩm">
                  </div>
                  <div class="mb-3">
                    <label for="editProductCategory" class="form-label">Danh mục *</label>
                    <select class="form-select" id="editProductCategory" required></select>
                  </div>
                  <div class="mb-3">
                    <label for="editProductGoldType" class="form-label">Loại vàng *</label>
                    <select class="form-select" id="editProductGoldType" required></select>
                  </div>
                  <div class="mb-3">
                    <label for="editProductPrice" class="form-label">Giá *</label>
                    <input type="number" class="form-control" id="editProductPrice" required>
                  </div>
                  <div class="mb-3">
                    <label for="editProductQuantity" class="form-label">Số lượng *</label>
                    <input type="number" class="form-control" id="editProductQuantity" required>
                  </div>
                  <div class="mb-3">
                    <label for="editProductDescription" class="form-label">Mô tả</label>
                    <textarea class="form-control" id="editProductDescription" rows="3" placeholder="Nhập mô tả sản phẩm"></textarea>
                  </div>
                  <div class="mb-3">
                    <label for="editProductStatus" class="form-label">Trạng thái</label>
                    <select class="form-select" id="editProductStatus">
                      <option value="Active">Đang hoạt động</option>
                      <option value="Inactive">Ngừng hoạt động</option>
                    </select>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="updateProduct()">Cập nhật</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- GoldType Section -->
      <div id="goldtype-section" style="display:none">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2>Quản lý loại vàng</h2>
          <button class="btn btn-primary" onclick="showCreateGoldTypeModal()">Thêm loại vàng</button>
        </div>
        <table class="table" id="goldtype-table">
          <thead>
            <tr>
              <th>Tên</th><th>Mô tả</th><th>Karat</th><th>PriceType</th><th>Trạng thái</th><th>Ngày tạo</th><th>Thao tác</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <!-- Modal Thêm/Sửa GoldType -->
      <div class="modal fade" id="goldTypeModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <form id="goldTypeForm">
              <div class="modal-header">
                <h5 class="modal-title" id="goldTypeModalTitle">Thêm loại vàng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <input type="hidden" id="goldTypeId">
                <div class="mb-3">
                  <label for="goldTypeName" class="form-label">Tên loại vàng</label>
                  <input type="text" class="form-control" id="goldTypeName" required>
                </div>
                <div class="mb-3">
                  <label for="goldTypeDescription" class="form-label">Mô tả</label>
                  <input type="text" class="form-control" id="goldTypeDescription">
                </div>
                <div class="mb-3">
                  <label for="goldTypeKarat" class="form-label">Karat</label>
                  <input type="number" class="form-control" id="goldTypeKarat" required>
                </div>
                <div class="mb-3">
                  <label for="goldTypePriceType" class="form-label">PriceType</label>
                  <input type="text" class="form-control" id="goldTypePriceType" required>
                </div>
                <div class="mb-3" id="goldTypeActiveGroup" style="display:none">
                  <label for="goldTypeIsActive" class="form-label">Trạng thái</label>
                  <select class="form-select" id="goldTypeIsActive">
                    <option value="true">Hoạt động</option>
                    <option value="false">Ngừng</option>
                  </select>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="submit" class="btn btn-primary" id="goldTypeModalSaveBtn">Lưu</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- GoldPrice Section -->
      <div id="goldprice-section" style="display:none">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2>Lịch sử giá vàng</h2>
          <button class="btn btn-primary" onclick="showCreateGoldPriceModal()">Thêm giá vàng</button>
        </div>
        <div class="mb-3">
          <label for="goldPriceTypeFilter" class="form-label">Chọn loại vàng</label>
          <select class="form-select" id="goldPriceTypeFilter"></select>
        </div>
        <table class="table" id="goldprice-table">
          <thead>
            <tr>
              <th>Loại vàng</th><th>Giá mua</th><th>Giá bán</th><th>Thời gian</th><th>Trạng thái</th><th>Ngày tạo</th><th>Thao tác</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <!-- Modal Thêm/Sửa GoldPrice -->
      <div class="modal fade" id="goldPriceModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <form id="goldPriceForm">
              <div class="modal-header">
                <h5 class="modal-title" id="goldPriceModalTitle">Thêm giá vàng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <input type="hidden" id="goldPriceId">
                <div class="mb-3">
                  <label for="goldPriceType" class="form-label">Loại vàng</label>
                  <select class="form-select" id="goldPriceType" required></select>
                </div>
                <div class="mb-3">
                  <label for="goldPriceBuy" class="form-label">Giá mua</label>
                  <input type="number" class="form-control" id="goldPriceBuy" required>
                </div>
                <div class="mb-3">
                  <label for="goldPriceSell" class="form-label">Giá bán</label>
                  <input type="number" class="form-control" id="goldPriceSell" required>
                </div>
                <div class="mb-3">
                  <label for="goldPriceRecordedAt" class="form-label">Thời gian ghi nhận</label>
                  <input type="datetime-local" class="form-control" id="goldPriceRecordedAt" required>
                </div>
                <div class="mb-3" id="goldPriceActiveGroup" style="display:none">
                  <label for="goldPriceIsActive" class="form-label">Trạng thái</label>
                  <select class="form-select" id="goldPriceIsActive">
                    <option value="true">Hoạt động</option>
                    <option value="false">Ngừng</option>
                  </select>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="submit" class="btn btn-primary" id="goldPriceModalSaveBtn">Lưu</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- End Dashboard Widgets -->
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Kiểm tra trạng thái đăng nhập khi trang được tải
    document.addEventListener('DOMContentLoaded', function() {
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập! Vui lòng đăng nhập để tiếp tục.',
          confirmButtonText: 'Đồng ý'
        }).then(() => {
          window.location.href = '../Account/login.html';
        });
        return;
      }
    });

    // Chuyển đổi section khi click sidebar
    document.getElementById('sidebar-dashboard').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('dashboard-section').style.display = '';
      document.getElementById('account-section').style.display = 'none';
      document.getElementById('category-section').style.display = 'none';
      document.getElementById('product-section').style.display = 'none';
      document.getElementById('goldtype-section').style.display = 'none';
      document.getElementById('goldprice-section').style.display = 'none';
      setActiveSidebar(this);
    });
    document.getElementById('sidebar-account').addEventListener('click', function(e) {
      console.log('Clicked Account tab');
      e.preventDefault();
      document.getElementById('dashboard-section').style.display = 'none';
      document.getElementById('account-section').style.display = '';
      document.getElementById('category-section').style.display = 'none';
      document.getElementById('product-section').style.display = 'none';
      document.getElementById('goldtype-section').style.display = 'none';
      document.getElementById('goldprice-section').style.display = 'none';
      setActiveSidebar(this);
      loadAccounts();
    });
    document.getElementById('sidebar-category').addEventListener('click', function(e) {
      console.log('Clicked Category tab');
      e.preventDefault();
      document.getElementById('dashboard-section').style.display = 'none';
      document.getElementById('account-section').style.display = 'none';
      document.getElementById('category-section').style.display = '';
      document.getElementById('product-section').style.display = 'none';
      document.getElementById('goldtype-section').style.display = 'none';
      document.getElementById('goldprice-section').style.display = 'none';
      setActiveSidebar(this);
      loadCategories();
    });
    document.getElementById('sidebar-product').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('dashboard-section').style.display = 'none';
      document.getElementById('account-section').style.display = 'none';
      document.getElementById('category-section').style.display = 'none';
      document.getElementById('product-section').style.display = '';
      document.getElementById('goldtype-section').style.display = 'none';
      document.getElementById('goldprice-section').style.display = 'none';
      setActiveSidebar(this);
      loadProducts();
    });
    // Sidebar chuyển tab GoldType/GoldPrice
    document.getElementById('sidebar-goldtype').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('dashboard-section').style.display = 'none';
      document.getElementById('account-section').style.display = 'none';
      document.getElementById('category-section').style.display = 'none';
      document.getElementById('product-section').style.display = 'none';
      document.getElementById('goldtype-section').style.display = '';
      document.getElementById('goldprice-section').style.display = 'none';
      setActiveSidebar(this);
      loadGoldTypes();
    });
    document.getElementById('sidebar-goldprice').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('dashboard-section').style.display = 'none';
      document.getElementById('account-section').style.display = 'none';
      document.getElementById('category-section').style.display = 'none';
      document.getElementById('product-section').style.display = 'none';
      document.getElementById('goldtype-section').style.display = 'none';
      document.getElementById('goldprice-section').style.display = '';
      setActiveSidebar(this);
      loadGoldTypes();
    });
    function setActiveSidebar(activeLink) {
      document.querySelectorAll('.sidebar .nav-link').forEach(function(link) {
        link.classList.remove('active');
      });
      activeLink.classList.add('active');
    }

    // Account Management Functions
    function loadAccounts() {
      console.log('Start loadAccounts');
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      $.ajax({
        url: 'https://localhost:5000/api/Account/all',
        method: 'GET',
        headers: { 
          'Authorization': 'Bearer ' + token 
        },
        success: function(accounts) {
          console.log('API /api/Account/all response:', accounts);
          renderAccounts(accounts);
        },
        error: function(xhr) {
          console.log('API /api/Account/all error:', xhr.status, xhr.responseText);
          Swal.fire({
            icon: 'error',
            title: 'Lỗi!',
            text: 'Không thể lấy danh sách tài khoản! ' + (xhr.responseText || ''),
            confirmButtonText: 'Đóng'
          });
        }
      });
    }

    function renderAccounts(accounts) {
      console.log('Render accounts:', accounts);
      const tbody = document.getElementById('accountsTableBody');
      tbody.innerHTML = '';
      accounts.forEach(acc => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${acc.id}</td>
          <td>${acc.username}</td>
          <td>${acc.email}</td>
          <td>${acc.fullName}</td>
          <td><span class="badge ${acc.roleName === 'Manager' ? 'bg-primary' : acc.roleName === 'Employee' ? 'bg-info' : 'bg-secondary'}">${acc.roleName}</span></td>
          <td><span class="badge ${acc.isActive ? 'bg-success' : 'bg-warning text-dark'}">${acc.isActive ? 'Active' : 'Inactive'}</span></td>
          <td>${acc.createdDate ? acc.createdDate.split('T')[0] : ''}</td>
          <td></td>
        `;
        tbody.appendChild(tr);
      });
      filterAccounts();
    }

    function createAccount() {
      const form = document.getElementById('createAccountForm');
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      // Validate password confirmation
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      if (password !== confirmPassword) {
        Swal.fire({
          icon: 'error',
          title: 'Lỗi!',
          text: 'Mật khẩu và xác nhận mật khẩu không khớp!',
          confirmButtonText: 'Đóng'
        });
        return;
      }
      // Lấy role
      const role = document.getElementById('role').value;
      if (role !== 'Employee' && role !== 'Nhân viên') {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Chỉ tạo được tài khoản nhân viên từ đây!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      const dto = {
        username: document.getElementById('username').value,
        password: password,
        confirmPassword: confirmPassword,
        fullName: document.getElementById('fullName').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        email: document.getElementById('email').value
      };
      $.ajax({
        url: 'https://localhost:5000/api/Account/create-employee',
        type: 'POST',
        headers: {
          'Authorization': 'Bearer ' + token,
          'Content-Type': 'application/json'
        },
        data: JSON.stringify(dto),
        success: function() {
          const modal = bootstrap.Modal.getInstance(document.getElementById('createAccountModal'));
          modal.hide();
          Swal.fire({
            icon: 'success',
            title: 'Thành công!',
            text: 'Tài khoản nhân viên đã được tạo thành công.',
            confirmButtonText: 'Đồng ý'
          });
          form.reset();
          loadAccounts();
        },
        error: function(xhr) {
          Swal.fire({
            icon: 'error',
            title: 'Lỗi!',
            text: 'Tạo tài khoản thất bại! ' + (xhr.responseText || ''),
            confirmButtonText: 'Đóng'
          });
        }
      });
    }

    function editAccount(accountId) {
      // Here you would typically fetch account data from your API
      // For demo purposes, we'll populate with sample data
      document.getElementById('editAccountId').value = accountId;
      document.getElementById('editUsername').value = 'john.doe';
      document.getElementById('editEmail').value = 'john.doe@example.com';
      document.getElementById('editFullName').value = 'John Doe';
      document.getElementById('editPhone').value = '+1234567890';
      document.getElementById('editRole').value = 'Manager';
      document.getElementById('editStatus').value = 'Active';
      document.getElementById('editAddress').value = '123 Main St, City, State';
      
      // Show the edit modal
      const editModal = new bootstrap.Modal(document.getElementById('editAccountModal'));
      editModal.show();
    }

    function updateAccount() {
      // Placeholder: cần endpoint update ở backend
      Swal.fire({
        icon: 'info',
        title: 'Thông báo!',
        text: 'Chức năng cập nhật tài khoản cần bổ sung endpoint API.',
        confirmButtonText: 'Đồng ý'
      });
    }

    function deleteAccount(accountId) {
      // Placeholder: cần endpoint xóa ở backend
      Swal.fire({
        icon: 'info',
        title: 'Thông báo!',
        text: 'Chức năng xóa tài khoản cần bổ sung endpoint API.',
        confirmButtonText: 'Đồng ý'
      });
    }

    // Filter and search functionality
    document.getElementById('roleFilter').addEventListener('change', filterAccounts);
    document.getElementById('statusFilter').addEventListener('change', filterAccounts);
    document.getElementById('searchAccount').addEventListener('input', filterAccounts);

    function filterAccounts() {
      const roleFilter = document.getElementById('roleFilter').value;
      const statusFilter = document.getElementById('statusFilter').value;
      const searchTerm = document.getElementById('searchAccount').value.toLowerCase();
      
      const rows = document.querySelectorAll('#accountsTableBody tr');
      
      rows.forEach(row => {
        const role = row.cells[4].textContent.trim();
        const status = row.cells[5].textContent.trim();
        const name = row.cells[3].textContent.toLowerCase();
        const email = row.cells[2].textContent.toLowerCase();
        
        const matchesRole = !roleFilter || role.includes(roleFilter);
        const matchesStatus = !statusFilter || status.includes(statusFilter);
        const matchesSearch = !searchTerm || name.includes(searchTerm) || email.includes(searchTerm);
        
        row.style.display = matchesRole && matchesStatus && matchesSearch ? '' : 'none';
      });
    }

    // Clear form when modal is closed
    document.getElementById('createAccountModal').addEventListener('hidden.bs.modal', function () {
      document.getElementById('createAccountForm').reset();
    });

    // Category Management Functions
    function loadCategories() {
      console.log('Start loadCategories');
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      $.ajax({
        url: 'https://localhost:5000/api/Category',
        type: 'GET',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(categories) {
          console.log('API /api/Category response:', categories);
          renderCategories(categories);
        },
        error: function(xhr) {
          console.log('API /api/Category error:', xhr.status, xhr.responseText);
          Swal.fire({
            icon: 'error',
            title: 'Lỗi!',
            text: 'Không thể lấy danh sách danh mục! ' + (xhr.responseText || ''),
            confirmButtonText: 'Đóng'
          });
        }
      });
    }

    function renderCategories(categories) {
      console.log('Render categories:', categories);
      const tbody = document.getElementById('categoriesTableBody');
      tbody.innerHTML = '';
      categories.forEach(cat => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${cat.id}</td>
          <td>${cat.name}</td>
          <td>${cat.description || ''}</td>
          <td><span class="badge ${cat.isActive ? 'bg-success' : 'bg-warning text-dark'}">${cat.isActive ? 'Đang hoạt động' : 'Ngừng hoạt động'}</span></td>
          <td>${cat.createdDate ? cat.createdDate.split('T')[0] : ''}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary me-1" onclick="editCategory(${cat.id})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteCategory(${cat.id})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      filterCategories();
    }

    function createCategory() {
      const form = document.getElementById('createCategoryForm');
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      const dto = {
        name: document.getElementById('categoryName').value,
        description: document.getElementById('categoryDescription').value
      };
      $.ajax({
        url: 'https://localhost:5000/api/Category',
        type: 'POST',
        headers: {
          'Authorization': 'Bearer ' + token,
          'Content-Type': 'application/json'
        },
        data: JSON.stringify(dto),
        success: function() {
          const modal = bootstrap.Modal.getInstance(document.getElementById('createCategoryModal'));
          modal.hide();
          Swal.fire({
            icon: 'success',
            title: 'Thành công!',
            text: 'Danh mục đã được tạo thành công.',
            confirmButtonText: 'Đồng ý'
          });
          form.reset();
          loadCategories();
        },
        error: function(xhr) {
          Swal.fire({
            icon: 'error',
            title: 'Lỗi!',
            text: 'Tạo danh mục thất bại! ' + (xhr.responseText || ''),
            confirmButtonText: 'Đóng'
          });
        }
      });
    }

    function editCategory(categoryId) {
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      $.ajax({
        url: `https://localhost:5000/api/Category/${categoryId}`,
        type: 'GET',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(category) {
          document.getElementById('editCategoryId').value = category.id;
          document.getElementById('editCategoryName').value = category.name;
          document.getElementById('editCategoryDescription').value = category.description || '';
          document.getElementById('editCategoryStatus').value = category.isActive ? 'Active' : 'Inactive';
          
          const editModal = new bootstrap.Modal(document.getElementById('editCategoryModal'));
          editModal.show();
        },
        error: function(xhr) {
          Swal.fire({
            icon: 'error',
            title: 'Lỗi!',
            text: 'Không thể lấy thông tin danh mục! ' + (xhr.responseText || ''),
            confirmButtonText: 'Đóng'
          });
        }
      });
    }

    function updateCategory() {
      const form = document.getElementById('editCategoryForm');
      const categoryId = document.getElementById('editCategoryId').value;
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      const dto = {
        name: document.getElementById('editCategoryName').value,
        description: document.getElementById('editCategoryDescription').value,
        isActive: document.getElementById('editCategoryStatus').value === 'Active'
      };
      $.ajax({
        url: `https://localhost:5000/api/Category/${categoryId}`,
        type: 'PUT',
        headers: {
          'Authorization': 'Bearer ' + token,
          'Content-Type': 'application/json'
        },
        data: JSON.stringify(dto),
        success: function() {
          const modal = bootstrap.Modal.getInstance(document.getElementById('editCategoryModal'));
          modal.hide();
          Swal.fire({
            icon: 'success',
            title: 'Thành công!',
            text: 'Danh mục đã được cập nhật thành công.',
            confirmButtonText: 'Đồng ý'
          });
          loadCategories();
        },
        error: function(xhr) {
          Swal.fire({
            icon: 'error',
            title: 'Lỗi!',
            text: 'Cập nhật danh mục thất bại! ' + (xhr.responseText || ''),
            confirmButtonText: 'Đóng'
          });
        }
      });
    }

    function deleteCategory(categoryId) {
      Swal.fire({
        title: 'Xác nhận xóa?',
        text: 'Bạn có chắc chắn muốn xóa danh mục này?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Xóa',
        cancelButtonText: 'Hủy'
      }).then((result) => {
        if (result.isConfirmed) {
          const token = localStorage.getItem('accessToken');
          if (!token) {
            Swal.fire({
              icon: 'warning',
              title: 'Cảnh báo!',
              text: 'Bạn chưa đăng nhập!',
              confirmButtonText: 'Đồng ý'
            });
            return;
          }
          $.ajax({
            url: `https://localhost:5000/api/Category/${categoryId}`,
            type: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + token },
            success: function() {
              Swal.fire({
                icon: 'success',
                title: 'Thành công!',
                text: 'Danh mục đã được xóa thành công.',
                confirmButtonText: 'Đồng ý'
              });
              loadCategories();
            },
            error: function(xhr) {
              Swal.fire({
                icon: 'error',
                title: 'Lỗi!',
                text: 'Xóa danh mục thất bại! ' + (xhr.responseText || ''),
                confirmButtonText: 'Đóng'
              });
            }
          });
        }
      });
    }

    // Filter and search functionality for categories
    document.getElementById('searchCategory').addEventListener('input', filterCategories);
    document.getElementById('statusCategoryFilter').addEventListener('change', filterCategories);

    function filterCategories() {
      const statusFilter = document.getElementById('statusCategoryFilter').value;
      const searchTerm = document.getElementById('searchCategory').value.toLowerCase();
      
      const rows = document.querySelectorAll('#categoriesTableBody tr');
      
      rows.forEach(row => {
        const status = row.cells[3].textContent.trim();
        const name = row.cells[1].textContent.toLowerCase();
        const description = row.cells[2].textContent.toLowerCase();
        
        const matchesStatus = !statusFilter || status.includes(statusFilter);
        const matchesSearch = !searchTerm || name.includes(searchTerm) || description.includes(searchTerm);
        
        row.style.display = matchesStatus && matchesSearch ? '' : 'none';
      });
    }

    // Clear form when category modal is closed
    document.getElementById('createCategoryModal').addEventListener('hidden.bs.modal', function () {
      document.getElementById('createCategoryForm').reset();
    });

    // Product Management Functions
    async function loadProducts() {
      console.log('Start loadProducts');
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      // Load both products and categories, then map category name
      try {
        const [products, categories] = await Promise.all([
          $.ajax({
            url: 'https://localhost:5000/api/Product',
            type: 'GET',
            headers: { 'Authorization': 'Bearer ' + token }
          }),
          $.ajax({
            url: 'https://localhost:5000/api/Category',
            type: 'GET',
            headers: { 'Authorization': 'Bearer ' + token }
          })
        ]);
        // Map categoryId to name
        const catMap = {};
        categories.forEach(cat => { catMap[cat.id] = cat.name; });
        products.forEach(prod => {
          prod.categoryName = catMap[prod.categoryId] || '';
        });
        renderProducts(products);
      } catch (xhr) {
        Swal.fire({
          icon: 'error',
          title: 'Lỗi!',
          text: 'Không thể lấy danh sách sản phẩm hoặc danh mục!',
          confirmButtonText: 'Đóng'
        });
      }
    }

    function renderProducts(products) {
      console.log('Render products:', products);
      const tbody = document.getElementById('productsTableBody');
      tbody.innerHTML = '';
      products.forEach(prod => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${prod.id}</td>
          <td>${prod.name}</td>
          <td>${prod.categoryName || ''}</td>
          <td>${prod.description || ''}</td>
          <td><span class="badge ${prod.isActive ? 'bg-success' : 'bg-warning text-dark'}">${prod.isActive ? 'Đang hoạt động' : 'Ngừng hoạt động'}</span></td>
          <td>${prod.createdDate ? prod.createdDate.split('T')[0] : ''}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary me-1" onclick="editProduct(${prod.id})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${prod.id})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      filterProducts();
    }

    async function createProduct() {
      const form = document.getElementById('createProductForm');
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      
      const dto = {
        name: document.getElementById('productName').value,
        description: document.getElementById('productDescription').value,
        categoryId: parseInt(document.getElementById('productCategory').value),
        goldTypeId: parseInt(document.getElementById('productGoldType').value),
        price: parseFloat(document.getElementById('productPrice').value),
        quantity: parseInt(document.getElementById('productQuantity').value)
      };
      
      try {
        // Tạo sản phẩm trước
        const productResponse = await $.ajax({
          url: 'https://localhost:5000/api/Product',
          type: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          },
          data: JSON.stringify(dto)
        });
        
        const productId = productResponse;
        
        // Upload ảnh nếu có
        const files = document.getElementById('productImages').files;
        if (files.length > 0) {
          await uploadMultipleProductImages(productId, files, token);
        }
        
        const modal = bootstrap.Modal.getInstance(document.getElementById('createProductModal'));
        modal.hide();
        Swal.fire({
          icon: 'success',
          title: 'Thành công!',
          text: 'Sản phẩm đã được tạo thành công.',
          confirmButtonText: 'Đồng ý'
        });
        form.reset();
        loadProducts();
      } catch (xhr) {
        Swal.fire({
          icon: 'error',
          title: 'Lỗi!',
          text: 'Tạo sản phẩm thất bại! ' + (xhr.responseText || ''),
          confirmButtonText: 'Đóng'
        });
      }
    }
    async function uploadMultipleProductImages(productId, files, token) {
      // Tạo danh sách ảnh để gửi
      const images = [];
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        // Convert file to base64 hoặc upload lên server trước
        const imageUrl = await convertFileToBase64(file);
        images.push({
          imageUrl: imageUrl,
          isMain: i === 0 // Ảnh đầu tiên là ảnh chính
        });
      }
      
      // Gọi API để tạo nhiều ảnh cùng lúc
      const dto = {
        productId: productId,
        images: images
      };
      
      return await $.ajax({
        url: 'https://localhost:5000/api/ProductImage/multiple',
        type: 'POST',
        headers: {
          'Authorization': 'Bearer ' + token,
          'Content-Type': 'application/json'
        },
        data: JSON.stringify(dto)
      });
    }
    
    function convertFileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
      });
    }
    
    // Function để preview ảnh
    function previewImages(input) {
      const preview = document.getElementById('imagePreview');
      preview.innerHTML = '';
      
      if (input.files && input.files.length > 0) {
        for (let i = 0; i < input.files.length; i++) {
          const file = input.files[i];
          const reader = new FileReader();
          
          reader.onload = function(e) {
            const div = document.createElement('div');
            div.className = 'position-relative';
            div.innerHTML = `
              <img src="${e.target.result}" class="img-thumbnail" style="width: 100px; height: 100px; object-fit: cover;" alt="Preview">
              <div class="position-absolute top-0 start-0 bg-primary text-white px-1 py-0 rounded" style="font-size: 0.7rem;">
                ${i === 0 ? 'Chính' : i + 1}
              </div>
            `;
            preview.appendChild(div);
          };
          
          reader.readAsDataURL(file);
        }
      }
    }
    
    // Giữ lại function cũ để tương thích ngược
    function uploadProductImage(productId, file, isMain, token) {
      const formData = new FormData();
      formData.append('productId', productId);
      formData.append('image', file);
      formData.append('isMain', isMain);
      $.ajax({
        url: 'https://localhost:5000/api/ProductImage',
        type: 'POST',
        headers: { 'Authorization': 'Bearer ' + token },
        data: formData,
        processData: false,
        contentType: false
      });
    }

    function editProduct(productId) {
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      // Load product, categories, gold types, rồi fill modal
      Promise.all([
        $.ajax({
          url: `https://localhost:5000/api/Product/${productId}`,
          type: 'GET',
          headers: { 'Authorization': 'Bearer ' + token }
        }),
        $.ajax({
          url: 'https://localhost:5000/api/Category',
          type: 'GET',
          headers: { 'Authorization': 'Bearer ' + token }
        }),
        $.ajax({
          url: 'https://localhost:5000/api/GoldType',
          type: 'GET',
          headers: { 'Authorization': 'Bearer ' + token }
        })
      ]).then(([product, categories, goldTypes]) => {
        document.getElementById('editProductId').value = product.id;
        document.getElementById('editProductName').value = product.name;
        document.getElementById('editProductDescription').value = product.description || '';
        document.getElementById('editProductStatus').value = product.isActive ? 'Active' : 'Inactive';
        // Fill category select
        const selectCat = document.getElementById('editProductCategory');
        selectCat.innerHTML = '';
        categories.forEach(cat => {
          const option = document.createElement('option');
          option.value = cat.id;
          option.textContent = cat.name;
          if (product.categoryId === cat.id) option.selected = true;
          selectCat.appendChild(option);
        });
        // Fill gold type select
        const selectGold = document.getElementById('editProductGoldType');
        selectGold.innerHTML = '';
        goldTypes.forEach(gt => {
          const option = document.createElement('option');
          option.value = gt.id;
          option.textContent = gt.name;
          if (product.goldTypeId === gt.id) option.selected = true;
          selectGold.appendChild(option);
        });
        document.getElementById('editProductPrice').value = product.price;
        document.getElementById('editProductQuantity').value = product.quantity;
        const editModal = new bootstrap.Modal(document.getElementById('editProductModal'));
        editModal.show();
      }).catch(xhr => {
        Swal.fire({
          icon: 'error',
          title: 'Lỗi!',
          text: 'Không thể lấy thông tin sản phẩm, danh mục hoặc loại vàng!',
          confirmButtonText: 'Đóng'
        });
      });
    }

    function updateProduct() {
      const form = document.getElementById('editProductForm');
      const productId = document.getElementById('editProductId').value;
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      const dto = {
        id: parseInt(productId),
        name: document.getElementById('editProductName').value,
        description: document.getElementById('editProductDescription').value,
        categoryId: parseInt(document.getElementById('editProductCategory').value),
        goldTypeId: parseInt(document.getElementById('editProductGoldType').value),
        price: parseFloat(document.getElementById('editProductPrice').value),
        quantity: parseInt(document.getElementById('editProductQuantity').value),
        isActive: document.getElementById('editProductStatus').value === 'Active'
      };
      $.ajax({
        url: `https://localhost:5000/api/Product/${productId}`,
        type: 'PUT',
        headers: {
          'Authorization': 'Bearer ' + token,
          'Content-Type': 'application/json'
        },
        data: JSON.stringify(dto),
        success: function() {
          const modal = bootstrap.Modal.getInstance(document.getElementById('editProductModal'));
          modal.hide();
          Swal.fire({
            icon: 'success',
            title: 'Thành công!',
            text: 'Sản phẩm đã được cập nhật thành công.',
            confirmButtonText: 'Đồng ý'
          });
          loadProducts();
        },
        error: function(xhr) {
          Swal.fire({
            icon: 'error',
            title: 'Lỗi!',
            text: 'Cập nhật sản phẩm thất bại! ' + (xhr.responseText || ''),
            confirmButtonText: 'Đóng'
          });
        }
      });
    }

    function deleteProduct(productId) {
      Swal.fire({
        title: 'Xác nhận xóa?',
        text: 'Bạn có chắc chắn muốn xóa sản phẩm này?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Xóa',
        cancelButtonText: 'Hủy'
      }).then((result) => {
        if (result.isConfirmed) {
          const token = localStorage.getItem('accessToken');
          if (!token) {
            Swal.fire({
              icon: 'warning',
              title: 'Cảnh báo!',
              text: 'Bạn chưa đăng nhập!',
              confirmButtonText: 'Đồng ý'
            });
            return;
          }
          $.ajax({
            url: `https://localhost:5000/api/Product/${productId}`,
            type: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + token },
            success: function() {
              Swal.fire({
                icon: 'success',
                title: 'Thành công!',
                text: 'Sản phẩm đã được xóa thành công.',
                confirmButtonText: 'Đồng ý'
              });
              loadProducts();
            },
            error: function(xhr) {
              Swal.fire({
                icon: 'error',
                title: 'Lỗi!',
                text: 'Xóa sản phẩm thất bại! ' + (xhr.responseText || ''),
                confirmButtonText: 'Đóng'
              });
            }
          });
        }
      });
    }

    // Filter and search functionality for products
    document.getElementById('searchProduct').addEventListener('input', filterProducts);
    document.getElementById('statusProductFilter').addEventListener('change', filterProducts);

    function filterProducts() {
      const statusFilter = document.getElementById('statusProductFilter').value;
      const searchTerm = document.getElementById('searchProduct').value.toLowerCase();
      const rows = document.querySelectorAll('#productsTableBody tr');
      rows.forEach(row => {
        const status = row.cells[4].textContent.trim();
        const name = row.cells[1].textContent.toLowerCase();
        const description = row.cells[3].textContent.toLowerCase();
        const matchesStatus = !statusFilter || status.includes(statusFilter);
        const matchesSearch = !searchTerm || name.includes(searchTerm) || description.includes(searchTerm);
        row.style.display = matchesStatus && matchesSearch ? '' : 'none';
      });
    }

    // Load categories for product create/edit modal
    function loadCategoriesForProductSelect(selectedId) {
      const token = localStorage.getItem('accessToken');
      if (!token) return;
      $.ajax({
        url: 'https://localhost:5000/api/Category',
        type: 'GET',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(categories) {
          const select = document.getElementById('productCategory');
          select.innerHTML = '';
          categories.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat.id;
            option.textContent = cat.name;
            if (selectedId && cat.id == selectedId) option.selected = true;
            select.appendChild(option);
          });
        }
      });
    }
    function loadCategoriesForProductEdit(selectedId) {
      const token = localStorage.getItem('accessToken');
      if (!token) return;
      $.ajax({
        url: 'https://localhost:5000/api/Category',
        type: 'GET',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(categories) {
          const select = document.getElementById('editProductCategory');
          select.innerHTML = '';
          categories.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat.id;
            option.textContent = cat.name;
            if (selectedId && cat.id == selectedId) option.selected = true;
            select.appendChild(option);
          });
        }
      });
    }
    // Clear form when product modal is closed
    document.getElementById('createProductModal').addEventListener('hidden.bs.modal', function () {
      document.getElementById('createProductForm').reset();
      document.getElementById('imagePreview').innerHTML = '';
    });
    // Load categories when open create product modal
    document.getElementById('createProductModal').addEventListener('show.bs.modal', function () {
      loadCategoriesForProductSelect();
      loadGoldTypesForProductSelect();
    });
    function loadGoldTypesForProductSelect(selectedId) {
      const token = localStorage.getItem('accessToken');
      if (!token) return;
      $.ajax({
        url: 'https://localhost:5000/api/GoldType',
        type: 'GET',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(goldTypes) {
          const select = document.getElementById('productGoldType');
          select.innerHTML = '';
          goldTypes.forEach(gt => {
            const option = document.createElement('option');
            option.value = gt.id;
            option.textContent = gt.name;
            if (selectedId && gt.id == selectedId) option.selected = true;
            select.appendChild(option);
          });
        }
      });
    }

    // ========== GOLD TYPE ==========
    function loadGoldTypes() {
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      
      $.ajax({
        url: 'https://localhost:5000/api/GoldType',
        type: 'GET',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(data) {
          const tbody = $('#goldtype-table tbody');
          tbody.empty();
          data.forEach(gt => {
            tbody.append(`
              <tr>
                <td>${gt.name}</td>
                <td>${gt.description || ''}</td>
                <td>${gt.karat}</td>
                <td>${gt.priceType}</td>
                <td>${gt.isActive ? 'Hoạt động' : 'Ngừng'}</td>
                <td>${gt.createdDate ? gt.createdDate.split('T')[0] : ''}</td>
                <td>
                  <button class="btn btn-sm btn-outline-primary me-1" onclick="showEditGoldTypeModal(${gt.id})"><i class="fas fa-edit"></i></button>
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteGoldType(${gt.id})"><i class="fas fa-trash"></i></button>
                </td>
              </tr>
            `);
          });
          // Load cho filter GoldPrice
          loadGoldTypeOptions(data);
        },
        error: function(xhr) {
          console.error('Error loading gold types:', xhr);
          Swal.fire({
            icon: 'error',
            title: 'Lỗi!',
            text: 'Không thể tải danh sách loại vàng! ' + (xhr.responseText || ''),
            confirmButtonText: 'Đóng'
          });
        }
      });
    }
    function showCreateGoldTypeModal() {
      $('#goldTypeModalTitle').text('Thêm loại vàng');
      $('#goldTypeForm')[0].reset();
      $('#goldTypeId').val('');
      $('#goldTypeActiveGroup').hide();
      $('#goldTypeModal').modal('show');
    }
    function showEditGoldTypeModal(id) {
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      
      $.ajax({
        url: `https://localhost:5000/api/GoldType/${id}`,
        type: 'GET',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(gt) {
          $('#goldTypeModalTitle').text('Sửa loại vàng');
          $('#goldTypeId').val(gt.id);
          $('#goldTypeName').val(gt.name);
          $('#goldTypeDescription').val(gt.description);
          $('#goldTypeKarat').val(gt.karat);
          $('#goldTypePriceType').val(gt.priceType);
          $('#goldTypeIsActive').val(gt.isActive ? 'true' : 'false');
          $('#goldTypeActiveGroup').show();
          $('#goldTypeModal').modal('show');
        },
        error: function(xhr) {
          Swal.fire({
            icon: 'error',
            title: 'Lỗi!',
            text: 'Không thể lấy thông tin loại vàng! ' + (xhr.responseText || ''),
            confirmButtonText: 'Đóng'
          });
        }
      });
    }
    $('#goldTypeForm').off('submit').on('submit', function(e) {
      e.preventDefault();
      const id = $('#goldTypeId').val();
      const dto = {
        name: $('#goldTypeName').val(),
        description: $('#goldTypeDescription').val(),
        karat: $('#goldTypeKarat').val() ? parseInt($('#goldTypeKarat').val()) : null,
        priceType: $('#goldTypePriceType').val()
      };
      if (id) {
        dto.id = parseInt(id);
        dto.isActive = $('#goldTypeIsActive').val() === 'true';
        $.ajax({
          url: `https://localhost:5000/api/GoldType/${id}`,
          type: 'PUT',
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('accessToken'),
            'Content-Type': 'application/json'
          },
          data: JSON.stringify(dto),
          success: function() {
            Swal.fire({
              icon: 'success',
              title: 'Thành công!',
              text: 'Cập nhật loại vàng thành công.',
              confirmButtonText: 'Đồng ý'
            }).then(() => {
              $('#goldTypeModal').modal('hide');
              loadGoldTypes();
            });
          },
          error: function(xhr) {
            Swal.fire({
              icon: 'error',
              title: 'Lỗi!',
              text: 'Cập nhật loại vàng thất bại! ' + (xhr.responseText || ''),
              confirmButtonText: 'Đóng'
            });
          }
        });
      } else {
        $.ajax({
          url: 'https://localhost:5000/api/GoldType',
          type: 'POST',
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('accessToken'),
            'Content-Type': 'application/json'
          },
          data: JSON.stringify(dto),
          success: function() {
            Swal.fire({
              icon: 'success',
              title: 'Thành công!',
              text: 'Thêm loại vàng thành công.',
              confirmButtonText: 'Đồng ý'
            }).then(() => {
              $('#goldTypeModal').modal('hide');
              loadGoldTypes();
            });
          },
          error: function(xhr) {
            Swal.fire({
              icon: 'error',
              title: 'Lỗi!',
              text: 'Tạo loại vàng thất bại! ' + (xhr.responseText || ''),
              confirmButtonText: 'Đóng'
            });
          }
        });
      }
    });
    function deleteGoldType(id) {
      Swal.fire({
        title: 'Xác nhận xóa?',
        text: 'Bạn có chắc chắn muốn xóa loại vàng này?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Xóa',
        cancelButtonText: 'Hủy'
      }).then((result) => {
        if (result.isConfirmed) {
          const token = localStorage.getItem('accessToken');
          if (!token) {
            Swal.fire({
              icon: 'warning',
              title: 'Cảnh báo!',
              text: 'Bạn chưa đăng nhập!',
              confirmButtonText: 'Đồng ý'
            });
            return;
          }
          
          $.ajax({
            url: `https://localhost:5000/api/GoldType/${id}`,
            type: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + token },
            success: function() {
              Swal.fire({
                icon: 'success',
                title: 'Thành công!',
                text: 'Loại vàng đã được xóa thành công.',
                confirmButtonText: 'Đồng ý'
              });
              loadGoldTypes();
            },
            error: function(xhr) {
              Swal.fire({
                icon: 'error',
                title: 'Lỗi!',
                text: 'Xóa loại vàng thất bại! ' + (xhr.responseText || ''),
                confirmButtonText: 'Đóng'
              });
            }
          });
        }
      });
    }
    // ========== GOLD PRICE ==========
    function loadGoldTypeOptions(goldTypes) {
      const select = $('#goldPriceTypeFilter');
      const selectModal = $('#goldPriceType');
      select.empty();
      selectModal.empty();
      select.append('<option value="">Tất cả loại vàng</option>'); // Thêm option tất cả
      goldTypes.forEach(gt => {
        select.append(`<option value="${gt.id}">${gt.name}</option>`);
        selectModal.append(`<option value="${gt.id}">${gt.name}</option>`);
      });
      loadGoldPrices('', goldTypes); // Mặc định show tất cả
    }
    $('#goldPriceTypeFilter').change(function() {
      const goldTypeId = $(this).val();
      loadGoldPrices(goldTypeId);
    });
    function loadGoldPrices(goldTypeId, goldTypesCache) {
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      
      $.ajax({
        url: 'https://localhost:5000/api/GoldPrice',
        type: 'GET',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(data) {
          const tbody = $('#goldprice-table tbody');
          tbody.empty();
          const goldTypes = goldTypesCache || $('#goldPriceTypeFilter option').map(function(){return {id:$(this).val(),name:$(this).text()};}).get();
          const goldTypeMap = {};
          goldTypes.forEach(gt => goldTypeMap[gt.id] = gt.name);
          data
            .filter(p => !goldTypeId || p.goldTypeId == goldTypeId) // Nếu goldTypeId rỗng thì show tất cả
            .forEach(p => {
              tbody.append(`
                <tr>
                  <td>${goldTypeMap[p.goldTypeId] || ''}</td>
                  <td>${p.buyPrice}</td>
                  <td>${p.sellPrice}</td>
                  <td>${p.recordedAt ? p.recordedAt.replace('T', ' ').substring(0, 16) : ''}</td>
                  <td>${p.isActive ? 'Hoạt động' : 'Ngừng'}</td>
                  <td>${p.createdDate ? p.createdDate.split('T')[0] : ''}</td>
                  <td>
                    <button class="btn btn-sm btn-outline-primary me-1" onclick="showEditGoldPriceModal(${p.id})"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteGoldPrice(${p.id})"><i class="fas fa-trash"></i></button>
                  </td>
                </tr>
              `);
            });
        },
        error: function(xhr) {
          console.error('Error loading gold prices:', xhr);
          Swal.fire({
            icon: 'error',
            title: 'Lỗi!',
            text: 'Không thể tải danh sách giá vàng! ' + (xhr.responseText || ''),
            confirmButtonText: 'Đóng'
          });
        }
      });
    }
    function showCreateGoldPriceModal() {
      $('#goldPriceModalTitle').text('Thêm giá vàng');
      $('#goldPriceForm')[0].reset();
      $('#goldPriceId').val('');
      $('#goldPriceActiveGroup').hide();
      $('#goldPriceModal').modal('show');
    }
    function showEditGoldPriceModal(id) {
      const token = localStorage.getItem('accessToken');
      if (!token) {
        Swal.fire({
          icon: 'warning',
          title: 'Cảnh báo!',
          text: 'Bạn chưa đăng nhập!',
          confirmButtonText: 'Đồng ý'
        });
        return;
      }
      
      $.ajax({
        url: `https://localhost:5000/api/GoldPrice/${id}`,
        type: 'GET',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(p) {
          $('#goldPriceModalTitle').text('Sửa giá vàng');
          $('#goldPriceId').val(p.id);
          $('#goldPriceType').val(p.goldTypeId);
          $('#goldPriceBuy').val(p.buyPrice);
          $('#goldPriceSell').val(p.sellPrice);
          $('#goldPriceRecordedAt').val(p.recordedAt ? p.recordedAt.substring(0, 16) : '');
          $('#goldPriceIsActive').val(p.isActive ? 'true' : 'false');
          $('#goldPriceActiveGroup').show();
          $('#goldPriceModal').modal('show');
        },
        error: function(xhr) {
          Swal.fire({
            icon: 'error',
            title: 'Lỗi!',
            text: 'Không thể lấy thông tin giá vàng! ' + (xhr.responseText || ''),
            confirmButtonText: 'Đóng'
          });
        }
      });
    }
    $('#goldPriceForm').off('submit').on('submit', function(e) {
      e.preventDefault();
      const id = $('#goldPriceId').val();
      const dto = {
        goldTypeId: parseInt($('#goldPriceType').val()),
        buyPrice: parseFloat($('#goldPriceBuy').val()),
        sellPrice: parseFloat($('#goldPriceSell').val()),
        recordedAt: $('#goldPriceRecordedAt').val()
      };
      if (id) {
        dto.id = parseInt(id);
        dto.isActive = $('#goldPriceIsActive').val() === 'true';
        $.ajax({
          url: `https://localhost:5000/api/GoldPrice/${id}`,
          type: 'PUT',
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('accessToken'),
            'Content-Type': 'application/json'
          },
          data: JSON.stringify(dto),
          success: function() {
            Swal.fire({
              icon: 'success',
              title: 'Thành công!',
              text: 'Cập nhật giá vàng thành công.',
              confirmButtonText: 'Đồng ý'
            }).then(() => {
              $('#goldPriceModal').modal('hide');
              loadGoldPrices($('#goldPriceTypeFilter').val());
            });
          },
          error: function(xhr) {
            Swal.fire({
              icon: 'error',
              title: 'Lỗi!',
              text: 'Cập nhật giá vàng thất bại! ' + (xhr.responseText || ''),
              confirmButtonText: 'Đóng'
            });
          }
        });
      } else {
        $.ajax({
          url: 'https://localhost:5000/api/GoldPrice',
          type: 'POST',
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('accessToken'),
            'Content-Type': 'application/json'
          },
          data: JSON.stringify(dto),
          success: function() {
            Swal.fire({
              icon: 'success',
              title: 'Thành công!',
              text: 'Thêm giá vàng thành công.',
              confirmButtonText: 'Đồng ý'
            }).then(() => {
              $('#goldPriceModal').modal('hide');
              loadGoldPrices($('#goldPriceTypeFilter').val());
            });
          },
          error: function(xhr) {
            Swal.fire({
              icon: 'error',
              title: 'Lỗi!',
              text: 'Tạo giá vàng thất bại! ' + (xhr.responseText || ''),
              confirmButtonText: 'Đóng'
            });
          }
        });
      }
    });
    function deleteGoldPrice(id) {
      Swal.fire({
        title: 'Xác nhận xóa?',
        text: 'Bạn có chắc chắn muốn xóa giá vàng này?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Xóa',
        cancelButtonText: 'Hủy'
      }).then((result) => {
        if (result.isConfirmed) {
          const token = localStorage.getItem('accessToken');
          if (!token) {
            Swal.fire({
              icon: 'warning',
              title: 'Cảnh báo!',
              text: 'Bạn chưa đăng nhập!',
              confirmButtonText: 'Đồng ý'
            });
            return;
          }
          
          $.ajax({
            url: `https://localhost:5000/api/GoldPrice/${id}`,
            type: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + token },
            success: function() {
              Swal.fire({
                icon: 'success',
                title: 'Thành công!',
                text: 'Giá vàng đã được xóa thành công.',
                confirmButtonText: 'Đồng ý'
              });
              loadGoldPrices($('#goldPriceTypeFilter').val());
            },
            error: function(xhr) {
              Swal.fire({
                icon: 'error',
                title: 'Lỗi!',
                text: 'Xóa giá vàng thất bại! ' + (xhr.responseText || ''),
                confirmButtonText: 'Đóng'
              });
            }
          });
        }
      });
    }
    // Logout function
    function logout() {
      Swal.fire({
        title: 'Xác nhận đăng xuất?',
        text: 'Bạn có chắc chắn muốn đăng xuất?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Đăng xuất',
        cancelButtonText: 'Hủy'
      }).then((result) => {
        if (result.isConfirmed) {
          // Xóa token khỏi localStorage
          localStorage.removeItem('accessToken');
          localStorage.removeItem('userProfile');
          
          // Hiển thị thông báo thành công
          Swal.fire({
            icon: 'success',
            title: 'Đăng xuất thành công!',
            text: 'Bạn đã được đăng xuất khỏi hệ thống.',
            confirmButtonText: 'Đồng ý'
          }).then(() => {
            // Chuyển hướng về trang đăng nhập
            window.location.href = '../Account/login.html';
          });
        }
      });
    }

    // ACCOUNT PAGINATION
    let accounts = [];
    let currentAccountPage = 1;
    const accountPageSize = 9;
    function renderAccounts(accountsData) {
      accounts = accountsData;
      renderAccountsTablePage(1);
    }
    function renderAccountsTablePage(page) {
      const tbody = document.getElementById('accountsTableBody');
      tbody.innerHTML = '';
      const sorted = [...accounts].sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));
      const start = (page - 1) * accountPageSize;
      const end = start + accountPageSize;
      const pageData = sorted.slice(start, end);
      pageData.forEach(acc => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${acc.id}</td>
          <td>${acc.username}</td>
          <td>${acc.email}</td>
          <td>${acc.fullName}</td>
          <td><span class="badge ${acc.roleName === 'Manager' ? 'bg-primary' : acc.roleName === 'Employee' ? 'bg-info' : 'bg-secondary'}">${acc.roleName}</span></td>
          <td><span class="badge ${acc.isActive ? 'bg-success' : 'bg-warning text-dark'}">${acc.isActive ? 'Active' : 'Inactive'}</span></td>
          <td>${acc.createdDate ? acc.createdDate.split('T')[0] : ''}</td>
          <td></td>
        `;
        tbody.appendChild(tr);
      });
      renderAccountPagination(sorted.length, page);
    }
    function renderAccountPagination(total, page) {
      const totalPages = Math.ceil(total / accountPageSize);
      let html = `<nav><ul class="pagination justify-content-center">`;
      html += `<li class="page-item${page === 1 ? ' disabled' : ''}"><a class="page-link" href="#" onclick="gotoAccountPage(${page - 1})">Previous</a></li>`;
      for (let i = 1; i <= totalPages; i++) {
        html += `<li class="page-item${i === page ? ' active' : ''}"><a class="page-link" href="#" onclick="gotoAccountPage(${i})">${i}</a></li>`;
      }
      html += `<li class="page-item${page === totalPages ? ' disabled' : ''}"><a class="page-link" href="#" onclick="gotoAccountPage(${page + 1})">Next</a></li>`;
      html += `</ul></nav>`;
      document.getElementById('accountPagination').innerHTML = html;
    }
    function gotoAccountPage(page) {
      if (page < 1) return;
      const totalPages = Math.ceil(accounts.length / accountPageSize);
      if (page > totalPages) return;
      currentAccountPage = page;
      renderAccountsTablePage(page);
    }
    // CATEGORY PAGINATION
    let categories = [];
    let currentCategoryPage = 1;
    const categoryPageSize = 9;
    function renderCategories(categoriesData) {
      categories = categoriesData;
      renderCategoriesTablePage(1);
    }
    function renderCategoriesTablePage(page) {
      const tbody = document.getElementById('categoriesTableBody');
      tbody.innerHTML = '';
      const sorted = [...categories].sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));
      const start = (page - 1) * categoryPageSize;
      const end = start + categoryPageSize;
      const pageData = sorted.slice(start, end);
      pageData.forEach(cat => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${cat.id}</td>
          <td>${cat.name}</td>
          <td>${cat.description || ''}</td>
          <td><span class="badge ${cat.isActive ? 'bg-success' : 'bg-warning text-dark'}">${cat.isActive ? 'Đang hoạt động' : 'Ngừng hoạt động'}</span></td>
          <td>${cat.createdDate ? cat.createdDate.split('T')[0] : ''}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary me-1" onclick="editCategory(${cat.id})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteCategory(${cat.id})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      renderCategoryPagination(sorted.length, page);
    }
    function renderCategoryPagination(total, page) {
      const totalPages = Math.ceil(total / categoryPageSize);
      let html = `<nav><ul class="pagination justify-content-center">`;
      html += `<li class="page-item${page === 1 ? ' disabled' : ''}"><a class="page-link" href="#" onclick="gotoCategoryPage(${page - 1})">Previous</a></li>`;
      for (let i = 1; i <= totalPages; i++) {
        html += `<li class="page-item${i === page ? ' active' : ''}"><a class="page-link" href="#" onclick="gotoCategoryPage(${i})">${i}</a></li>`;
      }
      html += `<li class="page-item${page === totalPages ? ' disabled' : ''}"><a class="page-link" href="#" onclick="gotoCategoryPage(${page + 1})">Next</a></li>`;
      html += `</ul></nav>`;
      document.getElementById('categoryPagination').innerHTML = html;
    }
    function gotoCategoryPage(page) {
      if (page < 1) return;
      const totalPages = Math.ceil(categories.length / categoryPageSize);
      if (page > totalPages) return;
      currentCategoryPage = page;
      renderCategoriesTablePage(page);
    }
    // PRODUCT PAGINATION
    let products = [];
    let currentProductPage = 1;
    const productPageSize = 9;
    function renderProducts(productsData) {
      products = productsData;
      renderProductsTablePage(1);
    }
    function renderProductsTablePage(page) {
      const tbody = document.getElementById('productsTableBody');
      tbody.innerHTML = '';
      const sorted = [...products].sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));
      const start = (page - 1) * productPageSize;
      const end = start + productPageSize;
      const pageData = sorted.slice(start, end);
      pageData.forEach(prod => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${prod.id}</td>
          <td>${prod.name}</td>
          <td>${prod.categoryName || ''}</td>
          <td>${prod.description || ''}</td>
          <td><span class="badge ${prod.isActive ? 'bg-success' : 'bg-warning text-dark'}">${prod.isActive ? 'Đang hoạt động' : 'Ngừng hoạt động'}</span></td>
          <td>${prod.createdDate ? prod.createdDate.split('T')[0] : ''}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary me-1" onclick="editProduct(${prod.id})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${prod.id})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      renderProductPagination(sorted.length, page);
    }
    function renderProductPagination(total, page) {
      const totalPages = Math.ceil(total / productPageSize);
      let html = `<nav><ul class="pagination justify-content-center">`;
      html += `<li class="page-item${page === 1 ? ' disabled' : ''}"><a class="page-link" href="#" onclick="gotoProductPage(${page - 1})">Previous</a></li>`;
      for (let i = 1; i <= totalPages; i++) {
        html += `<li class="page-item${i === page ? ' active' : ''}"><a class="page-link" href="#" onclick="gotoProductPage(${i})">${i}</a></li>`;
      }
      html += `<li class="page-item${page === totalPages ? ' disabled' : ''}"><a class="page-link" href="#" onclick="gotoProductPage(${page + 1})">Next</a></li>`;
      html += `</ul></nav>`;
      document.getElementById('productPagination').innerHTML = html;
    }
    function gotoProductPage(page) {
      if (page < 1) return;
      const totalPages = Math.ceil(products.length / productPageSize);
      if (page > totalPages) return;
      currentProductPage = page;
      renderProductsTablePage(page);
    }
  </script>
</body>
</html>
