<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoldTrack</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="../../css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <!-- Header -->
    <header class="fixed-top bg-white shadow-sm">
        <div class="header-container d-flex align-items-center justify-content-between py-2">
            <!-- Left Section -->
            <div class="hleft">
                <!-- Search -->
                <div class="hsearch ms-3">
                    <button aria-label="Search">
                        <svg width="27" height="27" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12.375" cy="12.375" r="7.875" stroke="#020203" stroke-width="3"></circle>
                            <path d="M24.1442 24.8365L20.7692 21.4615" stroke="#010101" stroke-width="3" stroke-linecap="round"></path>
                        </svg>
                    </button>
                    <input autocomplete="off" type="text" id="inputSearchHeader" name="q" placeholder="Tìm kiếm" aria-label="Search products" onkeydown="checkInputSearchEnter(event)">
                    <div id="searchHeaderArea"></div>
                </div>
            </div>
            <!-- Center Section (Logo) -->
            <div class="text-center">
                <a href="/" class="navbar-brand">
                    <i class="fas fa-gem me-2"></i>GoldTrack
                </a>
            </div>
            <!-- Right Section -->
            <div class="hright">
                <!-- Wishlist -->
                <div class="hwishlist">
                    <a href="/wishlist" aria-label="Wishlist">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5.93421 18.5443L15.3153 27.3568C15.6397 27.6616 15.802 27.814 16 27.814C16.198 27.814 16.3602 27.6616 16.6847 27.3568L26.0657 18.5443C28.674 16.0941 28.9907 12.0621 26.7971 9.23474L26.3846 8.7031C23.7603 5.32075 18.4928 5.888 16.6489 9.75151C16.3884 10.2973 15.6116 10.2973 15.3511 9.75151C13.5071 5.888 8.23961 5.32075 5.61537 8.7031L5.2029 9.23474C3.00924 12.0621 3.32598 16.0941 5.93421 18.5443Z" fill="#222222" stroke="#222222" stroke-width="2"></path>
                        </svg>
                        <div class="wish_count">0</div>
                    </a>
                </div>
                <!-- Cart -->
                <div class="hcheckout ms-3">
                    <a href="/cart" aria-label="Cart">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10.6667 16L10.6667 10.6667C10.6667 7.72115 13.0545 5.33334 16 5.33334V5.33334C18.9455 5.33334 21.3334 7.72115 21.3334 10.6667L21.3334 16" stroke="#222222" stroke-width="2" stroke-linecap="round"></path>
                            <path d="M5.02768 15.6678C5.17276 13.9269 5.24529 13.0565 5.81938 12.5282C6.39347 12 7.26693 12 9.01386 12H22.9861C24.7331 12 25.6065 12 26.1806 12.5282C26.7547 13.0565 26.8272 13.9269 26.9723 15.6678L27.8195 25.8339C27.904 26.8474 27.9462 27.3542 27.6491 27.6771C27.352 28 26.8435 28 25.8264 28H6.1736C5.15655 28 4.64802 28 4.35092 27.6771C4.05382 27.3542 4.09605 26.8474 4.18051 25.8339L5.02768 15.6678Z" fill="#222222"></path>
                        </svg>
                        <div class="cart_count">0</div>
                    </a>
                </div>
                <!-- Login -->
                <a id="login-btn" href="../../Pages/Account/login.html" class="btn btn-outline-primary ms-3">Đăng nhập</a>
                <div id="profile-dropdown" class="dropdown d-none ms-3">
                    <img class="avatar dropdown-toggle" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Profile" width="32" height="32" style="border-radius:50%; cursor:pointer;" data-bs-toggle="dropdown">
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="../../Pages/Account/profile.html" id="my-account-link">Tài khoản của tôi</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" onclick="logout()">Đăng xuất</a></li>
                    </ul>
                </div>    
            </div>
        </div>
        <!-- Navigation Menu -->
        <nav class="navbar navbar-expand-lg bg-white">
            <div class="container">
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="/">Trang chủ</a>
                        </li>

                        <li class="nav-item dropdown position-static">
                            <a class="nav-link dropdown-toggle" href="/Pages/Product/product.html" role="button" aria-expanded="false">
                                Sản phẩm
                            </a>
                            <ul class="dropdown-menu" id="product-category-dropdown">
                                <li><span class="dropdown-item text-muted">Đang tải...</span></li>
                            </ul>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/blogs/gia-vang-hom-nay">Giá vàng</a>
                        </li>
                        
                        <li class="nav-item dropdown position-static" id="news-dropdown-hover">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Tin tức
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/tin-khuyen-mai">Tin khuyến mãi</a></li>
                                <li><a class="dropdown-item" href="/blog-trang-suc">Blog trang sức</a></li>
                            </ul>
                        </li>
                        
                        <li class="nav-item">
                            <a class="nav-link" href="/lien-he">Liên hệ</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="/images/banner1.jpg" class="d-block w-100" alt="Banner 1">
                </div>
                <div class="carousel-item">
                    <img src="/images/banner2.jpg" class="d-block w-100" alt="Banner 2">
                </div>
                <div class="carousel-item">
                    <img src="/images/banner3.jpg" class="d-block w-100" alt="Banner 3">
                </div>
                <div class="carousel-item">
                    <img src="/images/banner4.jpg" class="d-block w-100" alt="Banner 4">
                </div>
                <div class="carousel-item">
                    <img src="/images/banner5.jpg" class="d-block w-100" alt="Banner 5">
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
            </button>
        </div>
        <div class="container hero-content text-center text-white py-5">
            <p class="lead mt-3">Khám phá thế giới trang sức cao cấp tại GoldTrack</p>
            <a href="#" class="btn btn-light me-2 mt-3">Xem giá vàng hôm nay</a>
            <a href="#" class="btn btn-warning mt-3">Mua ngay</a>
        </div>
    </section>

    <!-- Gold Price Section -->
    <section class="gold-price-section py-5">
        <div class="container">
            <h2 class="text-center mb-4"><i class="fas fa-coins text-warning me-2"></i>Giá Vàng Hôm Nay</h2>
            <div class="table-responsive">
                <table class="table table-bordered text-center align-middle shadow-sm">
                    <thead class="table-warning">
                        <tr>
                            <th>Loại vàng</th>
                            <th>Mua vào</th>
                            <th>Bán ra</th>
                        </tr>
                    </thead>
                    <tbody id="gold-price-tbody">
                        <tr><td colspan="3"><span class="spinner-border spinner-border-sm text-warning"></span> Đang tải...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Featured Products -->
    <section class="featured-products py-5">
        <div class="container">
            <h2 class="text-center mb-4"><i class="fas fa-star text-warning me-2"></i>Sản phẩm Nổi bật</h2>
            <div id="featured-products-row" class="row">
                <div class="text-center text-muted w-100" id="featured-products-loading">
                    <span class="spinner-border spinner-border-sm text-warning"></span> Đang tải...
                </div>
            </div>
        </div>
    </section>

    <!-- News Section -->
    <section class="news-section py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-4">Tin tức & Blog</h2>
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Tin tức">
                        <div class="card-body">
                            <h5 class="card-title">Giá vàng tăng mạnh trong tuần qua</h5>
                            <p class="card-text">Cập nhật ngày 01/07/2025</p>
                            <a href="#" class="btn btn-outline-primary">Đọc thêm</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Tin tức">
                        <div class="card-body">
                            <h5 class="card-title">Tư vấn đầu tư vàng hiệu quả</h5>
                            <p class="card-text">Cập nhật ngày 01/07/2025</p>
                            <a href="#" class="btn btn-outline-primary">Đọc thêm</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Tin tức">
                        <div class="card-body">
                            <h5 class="card-title">Ưu đãi đặc biệt tháng 7</h5>
                            <p class="card-text">Cập nhật ngày 01/07/2025</p>
                            <a href="#" class="btn btn-outline-primary">Đọc thêm</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>Liên hệ</h5>
                    <p>Địa chỉ: 123 Đường Vàng, Q.1, TP.HCM</p>
                    <p>Điện thoại: 0909 123 456</p>
                    <p>Email: info@kimbau.vn</p>
                </div>
                <div class="col-md-4">
                    <h5>Mạng xã hội</h5>
                    <a href="#" class="text-warning me-2"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-warning me-2"><i class="fab fa-zalo"></i></a>
                    <a href="#" class="text-warning"><i class="fab fa-instagram"></i></a>
                </div>
                <div class="col-md-4">
                    <h5>Đường dẫn nhanh</h5>
                    <a href="#" class="text-warning d-block mb-1">Chính sách bảo hành</a>
                    <a href="#" class="text-warning d-block mb-1">Vận chuyển</a>
                    <a href="#" class="text-warning d-block">Bảo mật</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        // Search functionality
        function checkInputSearchEnter(event) {
            if (event.key === 'Enter') {
                const query = event.target.value;
                window.location.href = `/search?q=${encodeURIComponent(query)}`;
            }
        }

        let goldTypeMap = {};
        async function loadGoldTypes() {
            try {
                const response = await fetch('https://localhost:5000/api/GoldType');
                if (!response.ok) throw new Error('Lỗi khi lấy loại vàng');
                const data = await response.json();
                goldTypeMap = {};
                data.forEach(gt => {
                    goldTypeMap[gt.id] = gt.name;
                });
            } catch (err) {
                goldTypeMap = {};
            }
        }

        async function fetchGoldPrices() {
            const tbody = document.getElementById('gold-price-tbody');
            tbody.innerHTML = '<tr><td colspan="3"><span class="spinner-border spinner-border-sm text-warning"></span> Đang tải...</td></tr>';
            try {
                const response = await fetch('https://localhost:5000/api/GoldPrice');
                if (!response.ok) throw new Error('Lỗi khi lấy dữ liệu');
                const data = await response.json();
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3">Không có dữ liệu</td></tr>';
                    return;
                }
                tbody.innerHTML = data.map(row => `
                    <tr>
                        <td><b>${goldTypeMap[row.goldTypeId] || 'Không xác định'}</b></td>
                        <td class="text-success fw-bold">${Number(row.buyPrice).toLocaleString('vi-VN')} <span class="text-muted">VNĐ</span></td>
                        <td class="text-danger fw-bold">${Number(row.sellPrice).toLocaleString('vi-VN')} <span class="text-muted">VNĐ</span></td>
                    </tr>
                `).join('');
            } catch (err) {
                tbody.innerHTML = `<tr><td colspan="3" class="text-danger">Lỗi: ${err.message}</td></tr>`;
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            await loadGoldTypes();
            fetchGoldPrices();
            loadProductCategoriesDropdown();
        });

        // Sản phẩm nổi bật
        async function fetchFeaturedProducts() {
            const row = document.getElementById('featured-products-row');
            row.innerHTML = '<div class="text-center text-muted w-100" id="featured-products-loading"><span class="spinner-border spinner-border-sm text-warning"></span> Đang tải...</div>';
            try {
                const response = await fetch('https://localhost:5000/api/Product');
                if (!response.ok) throw new Error('Lỗi khi lấy sản phẩm');
                const data = await response.json();
                if (!data || data.length === 0) {
                    row.innerHTML = '<div class="text-center text-muted w-100">Không có sản phẩm nổi bật</div>';
                    return;
                }
                // Lấy 4 sản phẩm đầu tiên (hoặc lọc theo tiêu chí nổi bật nếu có)
                const featured = data.slice(0, 4);
                row.innerHTML = featured.map(prod => `
                    <div class="col-md-3 col-sm-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <img src="${(prod.images && prod.images.length > 0) ? prod.images[0].imageUrl : 'https://via.placeholder.com/200x200'}" class="card-img-top" alt="${prod.name}">
                            <div class="card-body">
                                <h5 class="card-title">${prod.name}</h5>
                                <p class="card-text text-warning fw-bold">${Number(prod.price).toLocaleString('vi-VN')} VNĐ</p>
                                <a href="#" class="btn btn-outline-warning">Xem chi tiết</a>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                row.innerHTML = `<div class="text-center text-danger w-100">Lỗi: ${err.message}</div>`;
            }
        }
        fetchFeaturedProducts();
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const token = localStorage.getItem('accessToken');
            const loginBtn = document.getElementById('login-btn');
            const profileDropdown = document.getElementById('profile-dropdown');
            if (token) {
                if (loginBtn) loginBtn.style.display = 'none';
                if (profileDropdown) profileDropdown.classList.remove('d-none');
            } else {
                if (loginBtn) loginBtn.style.display = '';
                if (profileDropdown) profileDropdown.classList.add('d-none');
            }
            
            const myAccountLink = document.getElementById('my-account-link');
            if (myAccountLink) {
                myAccountLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    const token = localStorage.getItem('accessToken');
                    if (token) {
                        window.location.href = '../../Pages/Account/profile.html';
                    } else {
                        window.location.href = '../../Pages/Account/login.html';
                    }
                });
            }
        });

        // Logout function dùng SweetAlert2
        function logout() {
            Swal.fire({
                title: 'Xác nhận đăng xuất?',
                text: 'Bạn có chắc chắn muốn đăng xuất?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Đăng xuất',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Xóa token khỏi localStorage
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('userProfile');
                    // Hiển thị thông báo thành công
                    Swal.fire({
                        icon: 'success',
                        title: 'Đăng xuất thành công!',
                        text: 'Bạn đã được đăng xuất khỏi hệ thống.',
                        confirmButtonText: 'Đồng ý'
                    }).then(() => {
                        // Chuyển hướng về trang đăng nhập
                        window.location.href = '../../Pages/Account/login.html';
                    });
                }
            });
        }
    </script>
    <script>
        // Thay thế dropdown danh mục sản phẩm bằng dữ liệu động
        async function loadProductCategoriesDropdown() {
            const ul = document.getElementById('product-category-dropdown');
            ul.innerHTML = '<li><span class="dropdown-item text-muted">Đang tải...</span></li>';
            try {
                const response = await fetch('https://localhost:5000/api/Category');
                if (!response.ok) throw new Error('Lỗi khi lấy danh mục');
                const data = await response.json();
                if (!data || data.length === 0) {
                    ul.innerHTML = '<li><span class="dropdown-item text-muted">Không có danh mục</span></li>';
                    return;
                }
                ul.innerHTML = data.map(cat =>
                    `<li><a class="dropdown-item" href="/collections/category/${cat.id}">${cat.name}</a></li>`
                ).join('');
            } catch (err) {
                ul.innerHTML = `<li><span class="dropdown-item text-danger">Lỗi: ${err.message}</span></li>`;
            }
        }
        document.addEventListener('DOMContentLoaded', loadProductCategoriesDropdown);
    </script>
</body>
</html>